{% extends "page.html" %}

{% block body %}
	<p>Retrieves the relevant favicon for a URL, or returns a default icon should it not be able to find it. Works better than the <a href="http://simonwillison.net/2008/Aug/30/favicons/">Google version</a> as it will find favicons specified by an HTML page's <code>&lt;link&gt;</code> element. Feel free to hotlink, although it would be nice if you could <a href="mailto:mail@jasoncartwright.com">email me</a> if you're going to make more than a couple of requests a second.</p>

	<p>getFavicon's source is available at <a href="https://github.com/potatolondon/getfavicon">https://github.com/potatolondon/getfavicon</a></p>

	<h2>Instructions</h2>
	<p>To retrieve a favicon you can hotlink it at...</p>
	<pre>http://g.etfv.co/[URL]</pre>
	<p>Notice the URL contains the protocol (http or https). For example...</p>
	<pre><a href="http://g.etfv.co/http://www.google.com">http://g.etfv.co/http://www.google.com</a></pre>
	<p>This works well in an <code>&lt;img&gt;</code> tag...</p>
	<pre>&lt;img src="http://g.etfv.co/http://www.google.com" alt="Google" width="16" height="16" /&gt;</pre>

	<h3>Escaping</h3>
	<p>Of course, you'll need to escape the URL you want the favicon for. E.g...</p>
	<pre>http://g.etfv.co/http://www.google.com/search%3Fq%3Durlencode</pre>

	<h3>Default icon</h3>
	<p>You can specify a default icon to be displayed should the favicon not be found...</p>
	<pre>http://g.etfv.co/http://www.google.com?defaulticon=http://en.wikipedia.org/favicon.ico</pre>
	<p>You can also pass the following <code>defaulticon</code> values for other responses when a favicon isn't found:</p>
	<ul>
		<li><code>none</code>: no default icon will be returned (and an HTTP 204 "No content" response code)</li>
		<li><code>1pxgif</code>: 1px x 1px transparent GIF</li>
		<li><code>lightpng</code>: grey 'world' icon (as used by Google Chrome)</li>
		<li><code>bluepng</code>: light blue 'world' icon (as used by Google's favicon service)</li>
	</ul>

	<h3>HTTPS</h3>
	<p>You can request an HTTPS version like this...</p>
	<pre><a href="https://getfavicon.appspot.com/http://www.google.com">https://getfavicon.appspot.com/http://www.google.com</a></pre>
	<p>Or get the secure icon for a domain like this...</p>
	<pre><a href="http://g.etfv.co/https://encrypted.google.com">http://g.etfv.co/https://encrypted.google.com</a></pre>

	<h3>Multiple domains</h3>
	<p>To improve the performance of pages with many favicons on them you can overcome <a href="http://www.stevesouders.com/blog/2008/03/20/roundup-on-parallel-connections/">browser connection limits</a> by pointing to the icon on different domains. You can see this in action on the <a href="/test/">test page</a> (<a href="https://github.com/potatolondon/getfavicon/blob/master/templates/test.html">source</a>) where we use the first letter of the domain to generate a subdomain name. The domains are of the format...</p>
	<pre>http://[whatever].getfavicon.appspot.com/[URL]</pre>

	<h3>De-cache</h3>
	<p>You can remove an icon from the cache by calling <code>/decache/?domain=[domain]</code>. E.g. <a href="/decache/?domain=http://www.google.com">/decache/?domain=http://www.google.com</a>.</p>

	<h2>Examples</h2>
	<ul>
		<li><a href="/code.google.com/appengine/docs/python/urlfetch/fetchfunction.html"><img src="/code.google.com/appengine/docs/python/urlfetch/fetchfunction.html" alt="Google Code"/></a> Google Code</li>
		<li><a href="/https://twitter.com/jasoncartwright/status/2374528561"><img src="/https://twitter.com/jasoncartwright/status/2374528561" alt="Twitter" /></a> Twitter (retrieved over HTTPS)</li>
		<li><a href="/www.jasoncartwright.com"><img src="/jasoncartwright.com" alt="Author's site"></a> Author's site</li>
		<li><a href="https://getfavicon.appspot.com/docs.python.org/"><img src="https://getfavicon.appspot.com/docs.python.org/" alt="Python Docs"></a> Python Docs (delivered using HTTPS)</li>
		<li><a href="/g.etfv.co"><img src="/g.etfv.co" alt="Getting it's own icon" /></a> Getting it's own icon - before some wiseguy suggests it</li>
	</ul>

	<h3>More examples</h3>
	<ul class="icons">
		<li><a href="/www.yahoo.com"><img src="/www.yahoo.com" alt="Yahoo" /></a></li>
		<li><a href="/www.google.com"><img src="/www.google.com" alt="Google" /></a></li>
		<li><a href="/www.microsoft.com"><img src="/www.microsoft.com" alt="Microsoft" /></a></li>
		<li><a href="/www.facebook.com"><img src="/www.facebook.com" alt="Facebook" /></a></li>
		<li><a href="/www.youtube.com"><img src="/www.youtube.com" alt="YouTube" /></a></li>
		<li><a href="/www.wikipedia.org"><img src="/www.wikipedia.org" alt="Wikipedia" /></a></li>
		<li><a href="/www.baidu.com"><img src="/www.baidu.com" alt="Baidu" /></a></li>
		<li><a href="/www.myspace.com"><img src="/www.myspace.com" alt="MySpace" /></a></li>
		<li><a href="/www.twitter.com"><img src="/www.twitter.com" alt="Twitter" /></a></li>
		<li><a href="/www.wordpress.com"><img src="/www.wordpress.com" alt="Wordpress" /></a></li>
		<li><a href="/www.bing.com"><img src="/www.bing.com" alt="Bing" /></a></li>
		<li><a href="/www.ebay.com"><img src="/www.ebay.com" alt="EBay" /></a></li>
		<li><a href="/www.sina.com.cn"><img src="/www.sina.com.cn" alt="Sina" /></a></li>
		<li><a href="/www.amazon.com"><img src="/www.amazon.com" alt="Amazon" /></a></li>
		<li><a href="/www.craigslist.org"><img src="/www.craigslist.org" alt="Craig's List" /></a></li>
		<li><a href="/www.flickr.com"><img src="/www.flickr.com" alt="Flickr" /></a></li>
		<li><a href="/www.aol.com"><img src="/www.aol.com" alt="AOL" /></a></li>
		<li><a href="/www.hi5.com"><img src="/www.hi5.com" alt="Hi5" /></a></li>
		<li><a href="/www.imdb.com"><img src="/www.imdb.com" alt="IMDB" /></a></li>
		<li><a href="/www.163.com"><img src="/www.163.com" alt="163" /></a></li>
		<li><a href="/www.photobucket.com"><img src="/www.photobucket.com" alt="Photobucket" /></a></li>
		<li><a href="/www.bbc.co.uk"><img src="/www.bbc.co.uk" alt="BBC" /></a></li>
		<li><a href="/www.ask.com"><img src="/www.ask.com" alt="Ask" /></a></li>
		<li><a href="/www.apple.com"><img src="/www.apple.com" alt="Apple" /></a></li>
		<li><a href="/www.adobe.com"><img src="/www.adobe.com" alt="Adobe" /></a></li>
		<li><a href="/www.cnn.com"><img src="/www.cnn.com" alt="CNN" /></a></li>
		<li><a href="/www.youku.com"><img src="/www.youku.com" alt="youku.com" /></a></li>
		<li><a href="/www.linkedin.com"><img src="/www.linkedin.com" alt="LinkedIn" /></a></li>
		<li><a href="/www.whitehouse.gov"><img src="/www.whitehouse.gov" alt="Whitehouse" /></a></li>
		<li><a href="/www.number10.gov.uk"><img src="/www.number10.gov.uk" alt="Number 10" /></a></li>
		<li><a href="/play.tm"><img src="/play.tm" alt="play.tm" /></a></li>
		<li><a href="/www.mozilla.com"><img src="/www.mozilla.com" alt="Mozilla" /></a></li>
		<li><a href="/www.nytimes.com"><img src="/www.nytimes.com" alt="New York Times" /></a></li>
		<li><a href="/digg.com"><img src="/digg.com" alt="digg" /></a></li>
		<li><a href="/www.weather.com"><img src="/www.weather.com" alt="Weather.com" /></a></li>
		<li><a href="/www.answers.com"><img src="/www.answers.com" alt="answers.com" /></a></li>
		<li><a href="/www.theregister.co.uk"><img src="/www.theregister.co.uk" alt="The Register" /></a></li>
		<li><a href="/www.boingboing.net"><img src="/www.boingboing.net" alt="Boing Boing" /></a></li>
		<li><a href="/www.techcrunch.com"><img src="/www.techcrunch.com" alt="Tech Crunch" /></a></li>
		<li><a href="/www.mashable.com"><img src="/www.mashable.com" alt="Mashable" /></a></li>
		<li><a href="/www.gizmodo.com"><img src="/www.gizmodo.com" alt="Gizmodo" /></a></li>
		<li><a href="/www.guardian.co.uk"><img src="/www.guardian.co.uk" alt="Guardian" /></a></li>
		<li><a href="/www.telegraph.co.uk"><img src="/www.telegraph.co.uk" alt="Telegraph" /></a></li>
		<li><a href="/www.newscientist.com"><img src="/www.newscientist.com" alt="New Scientist" /></a></li>
	</ul>
	<p>1000 more examples on the <a href="/test/">test page</a>.</p>

	<h3>Last cached icons</h3>
	<ul class="icons">
		{% for icon in lastServedIcons %}
		<li><a href="{{ icon.domain|escape }}"><img src="/{{ icon.domain|escape }}" alt="{{ icon.domain|escape }}" /></a></li>
		{% endfor %}
	</ul>

	<h2>Stats</h2>
	<p class="ancillary">Updated every minute or so</p>
	<dl>
		<dt>Icons served</dt>
		<dd>{{ favIconsServed }} million</dd>
		<dt>Icons cached</dt>
		<dd>{{ iconsCached }} million</dd>
		<dt>Cache hit rate</dt>
		<dd>{{ percentCache }}%</dd>
		<dt>Unable to find favicon</dt>
		<dd>{{ error }}</dd>
        <dt>Error without retry</dt>
		<dd>{{ percentErrorCache }}%</dd>
	</dl>

	<h2>Implementations</h2>
	<ul>
		<li><a href="http://duckduckgo.com">DuckDuckGo</a></li>
		<li><a href="http://www.mediauk.com">Media UK</a></li>
		<li><a href="http://userscripts.org/scripts/show/40120">Google Reader Favicon ++</a> (Greasemonkey script)</li>
		<li><a href="http://www.jdempster.com">James Dempster</a></li>
		<li><a href="http://www.jasoncartwright.com">Jason Cartwright</a></li>
		<li><a href="http://geturlinfo.appspot.com">getURLinfo</a></li>
		<li><a href="http://play.tm/wire/">play.tm</a></li>
		<li><a href="http://friedcellcollective.net/outbreak/">Marko Mrdjenoviƒç</a></li>
		<li><a href="http://hail2u.net">hail2u.net</a></li>
		<li><a href="https://chrome.google.com/extensions/detail/jdnejaepfmacfdmhkplckpfdcjgbeode">'Yet Another Google Bookmarks Extension'</a></li>
		<li><a href="http://ultimatestatusbar.com">Ultimate Status Bar</a> (Safari extension)</li>
	</ul>

	<h2>Known problems</h2>
	<ul>
		<li>Sometimes <a href="http://twitter.com/mydogminton/status/2374789273">doesn't get the correct favicon</a> when there are multiple favicons per domain</li>
		<li>Some dodgy redirect handling when retrieving icon</li>
		<li>Sometimes returns incorrect MIME type</li>
		<li><s>Client-side caching is rubbish</s></li>
		<li><s>Some dicey error handling</s></li>
	</ul>

	<h2>Credit</h2>
	<p>By <img src="/www.jasoncartwright.com"/> <a href="http://www.jasoncartwright.com">Jason</a> from <img src="/p.ota.to"/> <a href="http://p.ota.to">Potato</a></p>

	<h3>Built using</h3>
	<ul>
		<li><img src="/code.google.com"/> <a href="http://code.google.com/appengine/">Google App Engine</a></li>
		<li><img src="/www.crummy.com/software/BeautifulSoup/"/> <a href="http://www.crummy.com/software/BeautifulSoup/">Beautiful Soup</a></li>
	</ul>
{% endblock %}